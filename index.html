<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>–ë—É–ª—å–∫ ‚Äî –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∫—Ä—É–≥</title>
  <meta name="color-scheme" content="light dark" />
  <meta name="description" content="–ë—É–ª—å–∫ ‚Äî –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫—Ä—É–≥–æ–≤–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è: 10 –∫—Ä—É–≥–æ–≤, –∫–∞–∂–¥—ã–π –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π PDF." />
  <meta name="theme-color" content="#f7efe6" />
  <link rel="preload" as="image" href="table.webp">
  <meta name="robots" content="noindex, nofollow" />
  <meta name="googlebot" content="noindex, nofollow" />
  <style>
    :root {
      --tap: 64; /* –¥–∏–∞–º–µ—Ç—Ä —Ç–∞–ø-–∑–æ–Ω—ã –≤ px –ø—Ä–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–µ –Ω–∞ —ç–∫—Ä–∞–Ω–µ */
      --table-k: 1; /* –º–∞—Å—à—Ç–∞–± –∫—Ä—É–≥–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ vmin */
      --ring-color: #cc4832;
      --hover-fill: rgba(255,255,255,0.12);
      --glow-color: #ff8a00; /* —Ü–≤–µ—Ç —Å–≤–µ—á–µ–Ω–∏—è —Ç–æ—á–µ–∫ */
      --bg-x: 50%;
      --bg-y: 335%;
      --bg-blur: 18px; /* —Å—Ç–µ–ø–µ–Ω—å —Ä–∞–∑–º—ã—Ç–∏—è —Ñ–æ–Ω–∞ */
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: #f7efe6;
      color: #321;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      touch-action: manipulation;
    }
    /* —Ä–∞–∑–º–∞–∑–∞–Ω–Ω—ã–π —Ñ–æ–Ω —á–µ—Ä–µ–∑ –ø—Å–µ–≤–¥–æ—ç–ª–µ–º–µ–Ω—Ç—ã */
    body::before {
      content: "";
      position: fixed; inset: 0;
      background: url('fon.webp') var(--bg-x, 50%) var(--bg-y, 50%) / cover no-repeat;
      filter: blur(var(--bg-blur, 18px));
      transform: scale(1.04); /* —á—Ç–æ–±—ã —Å–∫—Ä—ã—Ç—å –∫—Ä–∞—è –ø–æ—Å–ª–µ blur */
      transform-origin: center;
      z-index: -2;
      pointer-events: none;
    }
    body::after {
      content: "";
      position: fixed; inset: 0;
      background: linear-gradient(rgba(247,239,230,0.60), rgba(247,239,230,0.60));
      z-index: -1;
      pointer-events: none;
    }
    .stage {
      height: 100dvh;
      width: 100vw;
      display: grid;
      place-items: center;
      overflow: hidden;
    }
    svg {
      width: calc(100vmin * var(--table-k));
      height: calc(100vmin * var(--table-k));
      display: block;
    }

    /* –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–æ—á–∫–∏ */
    a.hotspot-link { outline: none; -webkit-tap-highlight-color: transparent; }
    circle.hotspot {
      fill: transparent;
      stroke: none;
      pointer-events: all;
      filter: none;
      transition: fill 140ms ease, transform 140ms ease, opacity 140ms ease;
      transform-box: fill-box;
      transform-origin: center;
    }
    circle.glow {
      fill: var(--glow-color);
      opacity: 0;
      pointer-events: none;
      filter: url(#softGlow);
      transition: opacity 160ms ease, transform 160ms ease;
      transform-box: fill-box;
      transform-origin: center;
    }
    a.hotspot-link:focus-visible circle.hotspot,
    a.hotspot-link:hover circle.hotspot {
      fill: var(--hover-fill);
      filter: drop-shadow(0 0 14px var(--glow-color)) drop-shadow(0 0 30px var(--glow-color));
      transform: scale(1.07);
    }

    /* –ø–æ–¥—Å–∫–∞–∑–∫–∞: –º—è–≥–∫–∞—è –ø—É–ª—å—Å–∞—Ü–∏—è –≤ –ø–µ—Ä–≤—ã–µ —Å–µ–∫—É–Ω–¥—ã */
    @keyframes hintPulse {
      0%   { fill: rgba(255,255,255,0.00); transform: scale(1); }
      50%  { fill: rgba(255,255,255,0.16); transform: scale(1.06); }
      100% { fill: rgba(255,255,255,0.00); transform: scale(1); }
    }
    .hints circle.glow { animation: hintPulse 1.6s ease-in-out infinite; }
    @media (prefers-reduced-motion: reduce) { .hints circle.glow, .sequence circle.glow { animation: none !important; } }

    /* –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ –ø–æ –∫—Ä—É–≥—É */
    .sequence circle.glow {
      animation: seqGlow var(--cycle, 12s) linear infinite;
      animation-delay: calc(var(--i) * var(--step, 1.2s));
    }
    @keyframes seqGlow {
      0%         { visibility: visible; opacity: 1; }
      9.8%       { visibility: visible; opacity: 1; }
      9.81%      { visibility: hidden; opacity: 0; }
      100%       { visibility: hidden; opacity: 0; }
    }

    body.debug circle.hotspot { fill: rgba(29,78,216,0.14); stroke: #1d4ed8; stroke-width: 1.5; }
    text.hotspot-label { display: none; }
    body.debug text.hotspot-label { display: block; fill: #1d4ed8; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; font-size: 12px; pointer-events: none; text-anchor: middle; dominant-baseline: middle; }

    #ctrl { position: fixed; left: 8px; right: 8px; bottom: 12px; transform: none; display: none; background: rgba(255,255,255,.92); border-radius: 12px; box-shadow: 0 6px 24px rgba(0,0,0,.16); padding: 8px 12px; gap: 10px; backdrop-filter: blur(8px); overflow-x: auto; -webkit-overflow-scrolling: touch; white-space: nowrap; }
    body.debug #ctrl { display: flex; align-items: center; flex-wrap: nowrap; }
    #ctrl label { font: 12px system-ui, sans-serif; color: #333; margin-right: 6px; white-space: nowrap; }
    #ctrl input[type=range] { width: 120px; }
    #ctrl .val { min-width: 42px; text-align: right; font: 600 12px system-ui, sans-serif; color: #111; }
    #copyBtn { margin-left: 8px; font: 12px system-ui, sans-serif; padding: 6px 8px; border-radius: 8px; border: 1px solid #ddd; background: #fff; }

    /* –Ω–∞ –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö –Ω–µ–º–Ω–æ–≥–æ —É–º–µ–Ω—å—à–∞–µ–º —Ä–∞–¥–∏—É—Å, —á—Ç–æ–±—ã –Ω–µ –≤—ã–ª–µ–∑–∞–ª–æ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã */
    @media (max-width: 360px) {
      :root { --tap: 64; }
    }
    @media (max-width: 520px) {
      #ctrl { padding: 6px 8px; gap: 8px; }
      #ctrl input[type=range] { width: 96px; }
      #ctrl .val { min-width: 36px; }
    }
    #topHint { position: fixed; top: 12px; left: 12px; z-index: 60; display: none; align-items: center; gap: 8px; padding: 8px 12px; background: rgba(255,255,255,.92); border: 1px solid rgba(0,0,0,0.06); border-radius: 12px; box-shadow: 0 8px 22px rgba(0,0,0,.12); backdrop-filter: blur(8px); font: 600 13px system-ui, -apple-system, Segoe UI, Roboto, sans-serif; color: #333; opacity: 0; transform: translateY(-6px); }
    #topHint.show { opacity: 1; transform: translateY(0); transition: opacity .28s ease, transform .28s ease; }
    #topHint .icon { font-size: 16px; line-height: 1; }
    #topHint .text { line-height: 1.2; }
  </style>
</head>
<body>
  <main class="stage">
    <!-- –ë–∞–∑–æ–≤—ã–π SVG –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä. –ò—Å–ø–æ–ª—å–∑—É–µ–º viewBox –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ -->
    <svg viewBox="0 0 793.2475 793.2475" role="img" aria-label="–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫—Ä—É–≥–æ–≤–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è">
      <defs>
        <filter id="glow" x="-60%" y="-60%" width="220%" height="220%">
          <!-- —Ä–∞–∑–º—ã–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω—É—é —Ñ–æ—Ä–º—É -->
          <feGaussianBlur in="SourceGraphic" stdDeviation="5" result="blur" />
          <!-- –æ–∫—Ä–∞—à–∏–≤–∞–µ–º —Ä–∞–∑–º—ã—Ç–∏–µ –≤ —è—Ä–∫–∏–π —Ü–≤–µ—Ç -->
          <feFlood flood-opacity="0.95" result="flood" style="flood-color: var(--glow-color)" />
          <feComposite in="flood" in2="blur" operator="in" result="coloredBlur" />
          <feMerge>
            <feMergeNode in="coloredBlur" />
            <feMergeNode in="SourceGraphic" />
          </feMerge>
        </filter>
        <filter id="softGlow" filterUnits="userSpaceOnUse" x="-2000" y="-2000" width="12000" height="12000">
          <feGaussianBlur stdDeviation="24" />
        </filter>
        <radialGradient id="edgeFade" cx="50%" cy="50%" r="50%">
          <stop offset="0%" stop-color="#fff" />
          <stop offset="94%" stop-color="#fff" />
          <stop offset="100%" stop-color="#000" />
        </radialGradient>
        <mask id="edgeMask" maskUnits="objectBoundingBox" maskContentUnits="objectBoundingBox">
          <rect x="0" y="0" width="1" height="1" fill="url(#edgeFade)" />
        </mask>
      </defs>
      <!-- –§–æ–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π table.webp -->
      <image href="table.webp" x="0" y="0" width="793.2475" height="793.2475" preserveAspectRatio="xMidYMid meet" style="pointer-events:none" mask="url(#edgeMask)" />

      <!-- –°–ª–æ–π —Å –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º–∏ —Ç–æ—á–∫–∞–º–∏ -->
      <g id="hotspots" />
      <g id="labels" />
    </svg>
  </main>

  <div id="topHint" aria-live="polite"><span class="icon">üëÜ</span><span class="text">–ù–∞–∂–∏–º–∞–π—Ç–µ –Ω–∞ –∫—Ä—É–∂–æ—á–∫–∏ ‚Äî –æ—Ç–∫—Ä–æ—é—Ç—Å—è PDF</span></div>

  <div id="ctrl">
    <label for="kRange">Size</label>
    <input id="kRange" type="range" min="0.60" max="1.00" step="0.005" />
    <span id="kVal" class="val"></span>
    <label for="tRange">r(px)</label>
    <input id="tRange" type="range" min="10" max="64" step="1" />
    <span id="tVal" class="val"></span>
    <label for="rRange">R</label>
    <input id="rRange" type="range" min="80" max="400" step="0.5" />
    <span id="RVal" class="val"></span>
    <label for="oRange">Offset</label>
    <input id="oRange" type="range" min="-30" max="30" step="1" />
    <span id="oVal" class="val"></span>
    <label for="bgxRange">BG X</label>
    <input id="bgxRange" type="range" min="-400" max="400" step="0.5" />
    <span id="bgxVal" class="val"></span>
    <label for="bgyRange">BG Y</label>
    <input id="bgyRange" type="range" min="-400" max="400" step="0.5" />
    <span id="bgyVal" class="val"></span>
    <label for="blurRange">BG Blur</label>
    <input id="blurRange" type="range" min="0" max="40" step="1" />
    <span id="blurVal" class="val"></span>
    <label for="glowRRange">Glow R</label>
    <input id="glowRRange" type="range" min="0" max="255" step="1" />
    <span id="glowRVal" class="val"></span>
    <label for="glowGRange">G</label>
    <input id="glowGRange" type="range" min="0" max="255" step="1" />
    <span id="glowGVal" class="val"></span>
    <label for="glowBRange">B</label>
    <input id="glowBRange" type="range" min="0" max="255" step="1" />
    <span id="glowBVal" class="val"></span>
    <button id="saveBtn" type="button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
    <button id="resetBtn" type="button">–°–±—Ä–æ—Å–∏—Ç—å</button>
    <button id="copyBtn" type="button">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
  </div>

  <script>
    (function() {
      const svgEl = document.querySelector('svg');
      const cx = 793.2475 / 2;
      const cy = 793.2475 / 2;
      let R = 229;
      let offset = 17;
      // –ß–∏—Ç–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–µ—Å–ª–∏ –µ—Å—Ç—å) –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ä–∞–∑—É
      let savedConf = {};
      try { savedConf = JSON.parse(localStorage.getItem('bulkqrConfig') || '{}') || {}; } catch(_) {}
      if (savedConf && typeof savedConf === 'object') {
        if (savedConf.tableK != null) document.documentElement.style.setProperty('--table-k', String(savedConf.tableK));
        if (savedConf.rPx != null) document.documentElement.style.setProperty('--tap', String(savedConf.rPx));
        if (typeof savedConf.R === 'number') R = savedConf.R;
        if (typeof savedConf.offset === 'number') offset = savedConf.offset;
        if (savedConf.bgX) document.documentElement.style.setProperty('--bg-x', savedConf.bgX);
        if (savedConf.bgY) document.documentElement.style.setProperty('--bg-y', savedConf.bgY);
        if (savedConf.bgBlur) document.documentElement.style.setProperty('--bg-blur', savedConf.bgBlur);
      }
      // –†–∞—Å—á—ë—Ç —Ä–∞–¥–∏—É—Å–∞ –∫—Ä—É–≥–∞ –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö viewBox, —á—Ç–æ–±—ã –¥–∏–∞–º–µ—Ç—Ä –Ω–∞ —ç–∫—Ä–∞–Ω–µ ‚âà var(--tap) px
      function computeR() {
        const style = getComputedStyle(document.documentElement);
        const tapPx = parseFloat(style.getPropertyValue('--tap')) || 56; // –¥–∏–∞–º–µ—Ç—Ä
        const rect = svgEl.getBoundingClientRect();
        const viewW = 793.2475;
        const scale = viewW / rect.width; // px —ç–∫—Ä–∞–Ω–∞ -> –µ–¥–∏–Ω–∏—Ü—ã viewBox
        return (tapPx / 2) * scale; // —Ä–∞–¥–∏—É—Å –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö viewBox
      }

      // –ò—Å—Ç–æ—á–Ω–∏–∫ –≤ —Ç—Ä–µ–±—É–µ–º–æ–º –ø–æ—Ä—è–¥–∫–µ –ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ, –Ω–∞—á–∞–ª–æ ‚Äî —Å 3 —á–∞—Å–æ–≤
      const src = [
        { file: 'sssr.pdf', label: '–ü–µ–ª—å–º–µ–Ω–∏ –≤ —ç–ø–æ—Ö—É –°–°–°–†' },
        { file: 'Otlichiya.pdf', label: '–ß–µ–º –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –ø–µ–ª—å–º–µ–Ω–∏ –æ—Ç‚Ä¶' },
        { file: 'razniestrani.pdf', label: '–ü–µ–ª—å–º–µ–Ω–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∞—Ö' },
        { file: 'interestingfacts.pdf', label: '–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ–∞–∫—Ç—ã' },
        { file: 'rituali.pdf', label: '–ü–µ–ª—å–º–µ–Ω–Ω—ã–µ —Ä–∏—Ç—É–∞–ª—ã –∏ –ø–æ–≤–µ—Ä—å–µ' },
        { file: 'uralsibir.pdf', label: '–ü–µ–ª—å–º–µ–Ω–∏ –≤ –°–∏–±–∏—Ä–∏ –∏ –Ω–∞ –£—Ä–∞–ª–µ' },
        { file: 'europe.pdf', label: '–ü–µ–ª—å–º–µ–Ω–∏ –≤ –ï–≤—Ä–æ–ø–µ –∏ –ê–∑–∏–∏ (–ï–≤—Ä–æ–ø–∞)' },
        { file: 'rus.pdf', label: '–ü–µ–ª—å–º–µ–Ω–∏ –Ω–∞ –†—É—Å–∏' },
        { file: 'china.pdf', label: '–ö–∏—Ç–∞–π' },
        { file: 'asia.pdf', label: '–ü–µ–ª—å–º–µ–Ω–∏ –≤ –ê–∑–∏–∏' }
      ];
      const N = src.length;
      const step = 360 / N;
      const angleIndex0 = -90 + offset;
      const iStart = ((Math.round((0 - angleIndex0) / step) % N) + N) % N;
      const files = Array.from({ length: N }, (_, k) => src[(k - iStart + N) % N]);

      const svgNS = 'http://www.w3.org/2000/svg';
      const hotspots = document.getElementById('hotspots');
      const labelsGroup = document.getElementById('labels');
      const params = new URLSearchParams(location.search);
      const debug = params.has('debug');
      if (debug) document.body.classList.add('debug');
      // –¶–≤–µ—Ç–∞ —Å–≤–µ—á–µ–Ω–∏—è –ø–æ –∫—Ä—É–≥—É
      const glowColors = ['#ff8a00'];
      // –í–∫–ª—é—á–∞–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—É—é –∞–Ω–∏–º–∞—Ü–∏—é
      hotspots.classList.add('sequence');
      const seqStep = 12 / files.length; // —Å–µ–∫ –Ω–∞ –æ–¥–∏–Ω —à–∞–≥, –æ–±—â–∏–π —Ü–∏–∫–ª ~12—Å
      hotspots.style.setProperty('--step', `${seqStep}s`);
      hotspots.style.setProperty('--cycle', `${(seqStep * files.length).toFixed(2)}s`);

      const baseAngles = files.map((_, i) => -90 + i * (360 / files.length));
      const circles = [];
      const glows = [];
      function setGlowColor(color) {
        document.querySelectorAll('.hotspot-link').forEach((a) => a.style.setProperty('--glow-color', color));
        circles.forEach((c) => c.style.setProperty('--glow-color', color));
        glows.forEach((gEl) => gEl.style.setProperty('--glow-color', color));
      }
      const labels = [];
      files.forEach((item, i) => {
        const a = document.createElementNS(svgNS, 'a');
        const url = `viewer.html?file=${encodeURIComponent('pdf/' + item.file)}`;
        a.setAttribute('href', url);
        a.setAttribute('target', '_self');
        a.setAttribute('class', 'hotspot-link');
        a.setAttribute('aria-label', item.label);
        a.setAttributeNS('http://www.w3.org/1999/xlink', 'xlink:href', url);
        const glow = document.createElementNS(svgNS, 'circle');
        glow.setAttribute('class', 'glow');
        // –ò–Ω–¥–µ–∫—Å —à–∞–≥–∞ –∏ —Ü–≤–µ—Ç —Å–≤–µ—á–µ–Ω–∏—è
        glow.style.setProperty('--i', String(i));
        const color = glowColors[i % glowColors.length];
        glow.style.setProperty('--glow-color', color);
        const circle = document.createElementNS(svgNS, 'circle');
        circle.setAttribute('class', 'hotspot');
        // –ò–Ω–¥–µ–∫—Å —à–∞–≥–∞ –∏ —Ü–≤–µ—Ç —Å–≤–µ—á–µ–Ω–∏—è
        circle.style.setProperty('--i', String(i));
        circle.style.setProperty('--glow-color', color);
        a.style.setProperty('--glow-color', color);
        a.appendChild(glow);
        a.appendChild(circle);
        hotspots.appendChild(a);
        circles.push(circle);
        glows.push(glow);
        // –°–Ω–∏–º–∞–µ–º —Ñ–æ–∫—É—Å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞, —á—Ç–æ–±—ã –Ω–µ –æ—Å—Ç–∞–≤–∞–ª—Å—è –∫—Ä–∞—Å–Ω—ã–π –∫—Ä—É–≥ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ
        a.addEventListener('click', () => { try { a.blur(); } catch(_){} });
        const t = document.createElementNS(svgNS, 'text');
        t.setAttribute('class', 'hotspot-label');
        t.textContent = String(i + 1);
        labelsGroup.appendChild(t);
        labels.push(t);
      });
      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —Ü–≤–µ—Ç —Å–≤–µ—á–µ–Ω–∏—è, –µ—Å–ª–∏ –µ—Å—Ç—å
      if (savedConf && savedConf.glowRGB) {
        const m = String(savedConf.glowRGB).match(/(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/);
        if (m) setGlowColor(`rgb(${m[1]}, ${m[2]}, ${m[3]})`);
      }

      function setPositions() {
        baseAngles.forEach((deg, i) => {
          const angle = (deg + offset) * Math.PI / 180;
          const x = cx + Math.cos(angle) * R;
          const y = cy + Math.sin(angle) * R;
          circles[i].setAttribute('cx', x.toFixed(2));
          circles[i].setAttribute('cy', y.toFixed(2));
          glows[i].setAttribute('cx', x.toFixed(2));
          glows[i].setAttribute('cy', y.toFixed(2));
          labels[i].setAttribute('x', x.toFixed(2));
          labels[i].setAttribute('y', y.toFixed(2));
        });
      }

      function applyRadius() {
        const r = computeR();
        circles.forEach(c => c.setAttribute('r', r));
        const rGlow = r * 0.7;
        glows.forEach(g => g.setAttribute('r', rGlow));
      }
      setPositions();
      applyRadius();
      window.addEventListener('resize', applyRadius);
      // –ü–æ–¥—Å–∫–∞–∑–∫–∞: —Å–Ω–∏–º–∞–µ–º –∫–ª–∞—Å—Å hints —á–µ—Ä–µ–∑ 6—Å –∏–ª–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏
      const svgRoot = document.querySelector('svg');
      const clearHints = () => { if (svgRoot) svgRoot.classList.remove('hints'); };
      setTimeout(clearHints, 6000);
      ['pointerdown','keydown','touchstart'].forEach(ev =>
        window.addEventListener(ev, clearHints, { once: true, passive: true })
      );

      // –õ—ë–≥–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –ª–µ–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–¥–∏–Ω —Ä–∞–∑)
      const HINT_KEY = 'bulkqrTopHintShown';
      const topHintEl = document.getElementById('topHint');
      function showTopHint(){ if (!topHintEl) return; topHintEl.style.display = 'flex'; requestAnimationFrame(() => topHintEl.classList.add('show')); }
      function hideTopHint(persist){ if (!topHintEl) return; topHintEl.classList.remove('show'); setTimeout(() => { topHintEl.style.display = 'none'; }, 250); if (persist) { try { localStorage.setItem(HINT_KEY, '1'); } catch(_) {} } }
      if (topHintEl && !localStorage.getItem(HINT_KEY)) {
        showTopHint();
        setTimeout(() => hideTopHint(true), 5000);
        ['pointerdown','keydown','touchstart'].forEach(ev => window.addEventListener(ev, () => hideTopHint(true), { once: true, passive: true }));
        topHintEl.addEventListener('click', () => hideTopHint(true));
      }

      // –°–Ω–∏–º–∞–µ–º —Ñ–æ–∫—É—Å—ã —É —Å—Å—ã–ª–æ–∫ –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞/–≤–∏–¥–∏–º–æ—Å—Ç–∏
      window.addEventListener('pageshow', () => {
        document.querySelectorAll('.hotspot-link').forEach((el) => { try { el.blur(); } catch(_){} });
      });
      document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'visible') {
          document.querySelectorAll('.hotspot-link').forEach((el) => { try { el.blur(); } catch(_){} });
        }
      });
      if (debug) {
        const kRange = document.getElementById('kRange');
        const tRange = document.getElementById('tRange');
        const rRange = document.getElementById('rRange');
        const oRange = document.getElementById('oRange');
        const bgxRange = document.getElementById('bgxRange');
        const bgyRange = document.getElementById('bgyRange');
        const kVal = document.getElementById('kVal');
        const tVal = document.getElementById('tVal');
        const RVal = document.getElementById('RVal');
        const oVal = document.getElementById('oVal');
        const bgxVal = document.getElementById('bgxVal');
        const bgyVal = document.getElementById('bgyVal');
        const blurVal = document.getElementById('blurVal');
        const saveBtn = document.getElementById('saveBtn');
        const resetBtn = document.getElementById('resetBtn');
        const glowRRange = document.getElementById('glowRRange');
        const glowGRange = document.getElementById('glowGRange');
        const glowBRange = document.getElementById('glowBRange');
        const glowRVal = document.getElementById('glowRVal');
        const glowGVal = document.getElementById('glowGVal');
        const glowBVal = document.getElementById('glowBVal');
        const copyBtn = document.getElementById('copyBtn');
        // –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º tRange —Ç–µ–∫—É—â–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º CSS-–ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
        const cs = getComputedStyle(document.documentElement);
        const currentTap = parseFloat(cs.getPropertyValue('--tap')) || 44;
        const currentK = parseFloat(cs.getPropertyValue('--table-k')) || 0.76;
        const rawBgX = (cs.getPropertyValue('--bg-x') || '').trim();
        const rawBgY = (cs.getPropertyValue('--bg-y') || '').trim();
        const currentBgX = rawBgX ? parseFloat(rawBgX) : 50;
        const currentBgY = rawBgY ? parseFloat(rawBgY) : 50;
        const rawBgBlur = (cs.getPropertyValue('--bg-blur') || '').trim();
        const currentBgBlur = rawBgBlur ? parseFloat(rawBgBlur) : 18;
        // –ó–∞–¥–∞–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å–±—Ä–æ—Å–∞
        const DEFAULTS = {
          tableK: 1,
          rPx: 64,
          R: 229,
          offset: 17,
          bgX: '50%',
          bgY: '335%',
          bgBlur: '18px',
          glow: { r: 255, g: 138, b: 0 }
        };
        // –≤—ã—á–∏—Å–ª—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π —Ü–≤–µ—Ç —Å–≤–µ—á–µ–Ω–∏—è
        function parseRGB(str){
          const m = (str || '').match(/rgba?\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)/i);
          return m ? [parseInt(m[1]), parseInt(m[2]), parseInt(m[3])] : null;
        }
        function parseHex(str){
          const s = (str || '').trim();
          if (!/^#?[0-9a-f]{6}$/i.test(s)) return null;
          const h = s.replace('#','');
          return [
            parseInt(h.slice(0,2),16),
            parseInt(h.slice(2,4),16),
            parseInt(h.slice(4,6),16)
          ];
        }
        let rgb = parseRGB(getComputedStyle(glows[0]).fill);
        if (!rgb) rgb = parseHex(cs.getPropertyValue('--glow-color')) || [255,138,0];
        kRange.value = String(currentK);
        tRange.value = String(currentTap);
        rRange.value = String(R);
        oRange.value = String(offset);
        bgxRange.value = String(currentBgX);
        bgyRange.value = String(currentBgY);
        blurRange.value = String(currentBgBlur);
        glowRRange.value = String(rgb[0]);
        glowGRange.value = String(rgb[1]);
        glowBRange.value = String(rgb[2]);
        kVal.textContent = String(currentK);
        tVal.textContent = String(Math.round(currentTap));
        RVal.textContent = String(R);
        oVal.textContent = String(offset);
        bgxVal.textContent = String(currentBgX);
        bgyVal.textContent = String(currentBgY);
        blurVal.textContent = String(currentBgBlur);
        glowRVal.textContent = String(rgb[0]);
        glowGVal.textContent = String(rgb[1]);
        glowBVal.textContent = String(rgb[2]);
        kRange.addEventListener('input', (e) => {
          const val = parseFloat(e.target.value) || currentK;
          document.documentElement.style.setProperty('--table-k', String(val));
          // —Ä–∞–¥–∏—É—Å—ã –∫–ª–∏–∫–∞ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ–º –ø–æ–¥ –Ω–æ–≤—ã–π –º–∞—Å—à—Ç–∞–±
          applyRadius();
          kVal.textContent = String(val);
        });
        tRange.addEventListener('input', (e) => {
          const val = parseFloat(e.target.value) || currentTap;
          document.documentElement.style.setProperty('--tap', String(val));
          applyRadius();
          tVal.textContent = String(Math.round(val));
        });
        rRange.addEventListener('input', (e) => { R = parseFloat(e.target.value) || R; setPositions(); RVal.textContent = String(R); });
        oRange.addEventListener('input', (e) => { offset = parseFloat(e.target.value) || 0; setPositions(); oVal.textContent = String(offset); });
        bgxRange.addEventListener('input', (e) => {
          const val = parseFloat(e.target.value) || 50;
          document.documentElement.style.setProperty('--bg-x', String(val) + '%');
          bgxVal.textContent = String(val);
        });
        bgyRange.addEventListener('input', (e) => {
          const val = parseFloat(e.target.value) || 50;
          document.documentElement.style.setProperty('--bg-y', String(val) + '%');
          bgyVal.textContent = String(val);
        });
        blurRange.addEventListener('input', (e) => {
          const val = parseFloat(e.target.value) || 18;
          document.documentElement.style.setProperty('--bg-blur', String(val) + 'px');
          blurVal.textContent = String(val);
        });
        function onRGBChange(){
          const r = parseInt(glowRRange.value)||0;
          const g = parseInt(glowGRange.value)||0;
          const b = parseInt(glowBRange.value)||0;
          glowRVal.textContent = String(r);
          glowGVal.textContent = String(g);
          glowBVal.textContent = String(b);
          setGlowColor(`rgb(${r}, ${g}, ${b})`);
        }
        glowRRange.addEventListener('input', onRGBChange);
        glowGRange.addEventListener('input', onRGBChange);
        glowBRange.addEventListener('input', onRGBChange);
        copyBtn.addEventListener('click', () => {
          const rPx = (getComputedStyle(document.documentElement).getPropertyValue('--tap') || '').trim();
          const tableK = (getComputedStyle(document.documentElement).getPropertyValue('--table-k') || '').trim();
          const bgX = ((getComputedStyle(document.documentElement).getPropertyValue('--bg-x') || '0%')).trim();
          const bgY = ((getComputedStyle(document.documentElement).getPropertyValue('--bg-y') || '0%')).trim();
          const bgBlur = ((getComputedStyle(document.documentElement).getPropertyValue('--bg-blur') || '0px')).trim();
          const r = parseInt(glowRRange.value)||0;
          const g = parseInt(glowGRange.value)||0;
          const b = parseInt(glowBRange.value)||0;
          const text = `tableK=${tableK}, rPx=${rPx}, R=${R}, offset=${offset}, bgX=${bgX}, bgY=${bgY}, bgBlur=${bgBlur}, glowRGB=rgb(${r},${g},${b})`;
          if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(text);
            copyBtn.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ';
            setTimeout(() => copyBtn.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å', 1200);
          } else {
            alert(text);
          }
        });

        saveBtn.addEventListener('click', () => {
          const csDoc = getComputedStyle(document.documentElement);
          const rPx = (csDoc.getPropertyValue('--tap') || '').trim();
          const tableK = (csDoc.getPropertyValue('--table-k') || '').trim();
          const bgX = (csDoc.getPropertyValue('--bg-x') || '50%').trim();
          const bgY = (csDoc.getPropertyValue('--bg-y') || '50%').trim();
          const bgBlur = (csDoc.getPropertyValue('--bg-blur') || '18px').trim();
          const rC = parseInt(glowRRange.value)||0;
          const gC = parseInt(glowGRange.value)||0;
          const bC = parseInt(glowBRange.value)||0;
          const conf = {
            tableK: parseFloat(tableK),
            rPx: parseFloat(rPx),
            R,
            offset,
            bgX,
            bgY,
            bgBlur,
            glowRGB: `rgb(${rC},${gC},${bC})`
          };
          try { localStorage.setItem('bulkqrConfig', JSON.stringify(conf)); } catch(_) {}
          const prevText = saveBtn.textContent;
          saveBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ';
          setTimeout(() => saveBtn.textContent = prevText || '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è', 1200);
        });

        // –°–±—Ä–æ—Å –∫ –¥–µ—Ñ–æ–ª—Ç—É
        resetBtn.addEventListener('click', () => {
          try { localStorage.removeItem('bulkqrConfig'); } catch(_) {}
          // CSS-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
          document.documentElement.style.setProperty('--table-k', String(DEFAULTS.tableK));
          document.documentElement.style.setProperty('--tap', String(DEFAULTS.rPx));
          document.documentElement.style.setProperty('--bg-x', DEFAULTS.bgX);
          document.documentElement.style.setProperty('--bg-y', DEFAULTS.bgY);
          document.documentElement.style.setProperty('--bg-blur', DEFAULTS.bgBlur);
          // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–∫—Ä—É–∂–Ω–æ—Å—Ç–∏
          R = DEFAULTS.R;
          offset = DEFAULTS.offset;
          setPositions();
          applyRadius();
          // –¶–≤–µ—Ç —Å–≤–µ—á–µ–Ω–∏—è
          setGlowColor(`rgb(${DEFAULTS.glow.r}, ${DEFAULTS.glow.g}, ${DEFAULTS.glow.b})`);
          // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤ –∏ –ø–æ–¥–ø–∏—Å–∏
          kRange.value = String(DEFAULTS.tableK);
          tRange.value = String(DEFAULTS.rPx);
          rRange.value = String(DEFAULTS.R);
          oRange.value = String(DEFAULTS.offset);
          bgxRange.value = String(parseFloat(DEFAULTS.bgX));
          bgyRange.value = String(parseFloat(DEFAULTS.bgY));
          blurRange.value = String(parseFloat(DEFAULTS.bgBlur));
          glowRRange.value = String(DEFAULTS.glow.r);
          glowGRange.value = String(DEFAULTS.glow.g);
          glowBRange.value = String(DEFAULTS.glow.b);
          kVal.textContent = String(DEFAULTS.tableK);
          tVal.textContent = String(DEFAULTS.rPx);
          RVal.textContent = String(DEFAULTS.R);
          oVal.textContent = String(DEFAULTS.offset);
          bgxVal.textContent = String(parseFloat(DEFAULTS.bgX));
          bgyVal.textContent = String(parseFloat(DEFAULTS.bgY));
          blurVal.textContent = String(parseFloat(DEFAULTS.bgBlur));
          glowRVal.textContent = String(DEFAULTS.glow.r);
          glowGVal.textContent = String(DEFAULTS.glow.g);
          glowBVal.textContent = String(DEFAULTS.glow.b);
          const prev = resetBtn.textContent;
          resetBtn.textContent = '–°–±—Ä–æ—à–µ–Ω–æ';
          setTimeout(() => resetBtn.textContent = prev || '–°–±—Ä–æ—Å–∏—Ç—å', 1200);
        });
      }

      // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∑–æ–Ω—É –∫–ª–∏–∫–∞ –¥–ª—è —Ç–∞—á-—É—Å—Ç—Ä–æ–π—Å—Ç–≤ —á–µ—Ä–µ–∑ pointer-events
      // –í–∏–∑—É–∞–ª—å–Ω–æ –∫—Ä—É–≥–∏ –Ω–µ–≤–∏–¥–∏–º—ã, –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ hover/focus
    })();
  </script>
</body>
</html>
