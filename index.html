<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="screen-orientation" content="portrait" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <title>–ú—É–∑–µ–π –ü–µ–ª—å–º–µ–Ω–µ–π</title>
  <meta name="color-scheme" content="light dark" />
  <meta name="description" content="–ú—É–∑–µ–π –ü–µ–ª—å–º–µ–Ω–µ–π" />
  <meta name="theme-color" content="#f7efe6" />
  <meta name="robots" content="noindex, nofollow" />
  <meta name="googlebot" content="noindex, nofollow" />
  <link rel="preload" as="image" href="fon.webp" type="image/webp" />
  <style>
    :root {
      --tap: 64; /* –¥–∏–∞–º–µ—Ç—Ä —Ç–∞–ø-–∑–æ–Ω—ã –≤ px –ø—Ä–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–µ –Ω–∞ —ç–∫—Ä–∞–Ω–µ */
      --table-k: 1; /* –º–∞—Å—à—Ç–∞–± –∫—Ä—É–≥–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ vmin */
      --ring-color: #cc4832;
      --hover-fill: rgba(255,255,255,0.12);
      --glow-color: rgb(211,126,102); /* —Ü–≤–µ—Ç —Å–≤–µ—á–µ–Ω–∏—è —Ç–æ—á–µ–∫ */
      --glow-blur: 30; /* —Ä–∞–¥–∏—É—Å —Ä–∞–∑–º—ã—Ç–∏—è */
      --glow-spread: 5; /* —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–Ω–∏ */
      --glow-intensity: 0.6; /* –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å */
      --bg-x: 50%;
      --bg-y: 335%;
      --bg-blur: 18px; /* —Å—Ç–µ–ø–µ–Ω—å —Ä–∞–∑–º—ã—Ç–∏—è —Ñ–æ–Ω–∞ */
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: #f7efe6;
      color: #321;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      touch-action: manipulation;
    }
    /* —Ñ–æ–Ω: —Ä–∞–∑–º–∞–∑–∞–Ω–Ω—ã–π fon.webp –ø–æ–¥ —Å–ª–æ–µ–º —Å pic.pdf */
    body::before {
      content: "";
      position: fixed; inset: 0;
      background: url('fon.webp') var(--bg-x, 50%) var(--bg-y, 50%) / cover no-repeat;
      filter: blur(var(--bg-blur, 18px));
      transform: scale(1.04);
      transform-origin: center;
      z-index: -2;
      pointer-events: none;
    }
    body::after {
      content: "";
      position: fixed; inset: 0;
      background: linear-gradient(rgba(247,239,230,0.60), rgba(247,239,230,0.60));
      z-index: -1;
      pointer-events: none;
    }
    .stage {
      height: 100dvh;
      width: 100vw;
      display: grid;
      place-items: center;
      overflow: hidden;
      position: relative;
      z-index: 1;
    }
    svg {
      width: 100vw;
      height: 100dvh;
      display: block;
    }

    /* –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–æ—á–∫–∏ */
    a.hotspot-link { outline: none; -webkit-tap-highlight-color: transparent; }
    circle.hotspot {
      fill: var(--glow-color);
      fill-opacity: 0.15;
      stroke: none;
      cursor: pointer;
      pointer-events: all;
      transition: all 200ms ease;
      transform-box: fill-box;
      transform-origin: center;
      filter: url(#circleGlow);
      opacity: var(--glow-intensity);
    }
    circle.glow {
      display: none; /* –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º */
    }
    a.hotspot-link:focus-visible circle.hotspot,
    a.hotspot-link:hover circle.hotspot {
      fill-opacity: 0.3;
      transform: scale(1.1);
      opacity: 1;
    }

    /* –ø–æ–¥—Å–∫–∞–∑–∫–∞: –º—è–≥–∫–∞—è –ø—É–ª—å—Å–∞—Ü–∏—è –≤ –ø–µ—Ä–≤—ã–µ —Å–µ–∫—É–Ω–¥—ã */
    @keyframes hintPulse {
      0%   { opacity: 0.3; transform: scale(1); }
      50%  { opacity: 1; transform: scale(1.08); }
      100% { opacity: 0.3; transform: scale(1); }
    }
    .hints circle.hotspot { animation: hintPulse 1.6s ease-in-out infinite; }
    @media (prefers-reduced-motion: reduce) { .hints circle.hotspot, .sequence circle.hotspot { animation: none !important; } }
    /* –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è —Å–≤–µ—á–µ–Ω–∏—è */
    @keyframes glowPulse {
      0%, 100% { 
        opacity: calc(var(--glow-intensity) * 0.6);
        transform: scale(1); 
      }
      50% { 
        opacity: var(--glow-intensity);
        transform: scale(1.05); 
      }
    }
    .sequence circle.hotspot {
      animation: glowPulse var(--step) ease-in-out infinite;
      animation-delay: calc(var(--i) * var(--step));
    }


    body.debug circle.hotspot { 
      fill: rgba(29,78,216,0.14) !important; 
      stroke: #1d4ed8 !important; 
      stroke-width: 1.5 !important; 
      cursor: move; 
      filter: none !important;
      opacity: 1 !important;
    }
    text.hotspot-label { display: none; }
    body.debug text.hotspot-label { display: block; fill: #1d4ed8; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; font-size: 12px; pointer-events: none; text-anchor: middle; dominant-baseline: middle; }

    #ctrl { position: fixed; left: 8px; right: 8px; bottom: 12px; transform: none; display: none; background: rgba(255,255,255,.92); border-radius: 12px; box-shadow: 0 6px 24px rgba(0,0,0,.16); padding: 8px 12px; gap: 10px; backdrop-filter: blur(8px); overflow-x: auto; -webkit-overflow-scrolling: touch; white-space: nowrap; z-index: 80; touch-action: pan-x; }
    body.debug #ctrl { display: flex; align-items: center; flex-wrap: nowrap; }
    #ctrl label { font: 12px system-ui, sans-serif; color: #333; margin-right: 6px; white-space: nowrap; }
    #ctrl input[type=range] { width: 120px; }
    #ctrl .val { min-width: 42px; text-align: right; font: 600 12px system-ui, sans-serif; color: #111; }
    #copyBtn { margin-left: 8px; font: 12px system-ui, sans-serif; padding: 6px 8px; border-radius: 8px; border: 1px solid #ddd; background: #fff; }

    /* –Ω–∞ –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö –Ω–µ–º–Ω–æ–≥–æ —É–º–µ–Ω—å—à–∞–µ–º —Ä–∞–¥–∏—É—Å, —á—Ç–æ–±—ã –Ω–µ –≤—ã–ª–µ–∑–∞–ª–æ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã */
    @media (max-width: 360px) {
      :root { --tap: 64; }
    }
    @media (max-width: 520px) {
      #ctrl { padding: 6px 8px; gap: 8px; }
      #ctrl input[type=range] { width: 96px; }
      #ctrl .val { min-width: 36px; }
    }
    #topHint { position: fixed; top: 12px; left: 12px; z-index: 60; display: none; align-items: center; gap: 8px; padding: 8px 12px; background: rgba(255,255,255,.92); border: 1px solid rgba(0,0,0,0.06); border-radius: 12px; box-shadow: 0 8px 22px rgba(0,0,0,.12); backdrop-filter: blur(8px); font: 600 13px system-ui, -apple-system, Segoe UI, Roboto, sans-serif; color: #333; opacity: 0; transform: translateY(-6px); }
    #topHint.show { opacity: 1; transform: translateY(0); transition: opacity .28s ease, transform .28s ease; }
    #topHint .icon { font-size: 16px; line-height: 1; }
    #topHint .text { line-height: 1.2; }
    /* –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å PDF-—Ñ–æ–Ω–æ–º */
    #bgPdf { position: fixed; inset: 0; z-index: 0; 
      -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 10%, rgba(0,0,0,1) 90%, rgba(0,0,0,0) 100%);
      mask-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%, rgba(0,0,0,1) 10%, rgba(0,0,0,1) 90%, rgba(0,0,0,0) 100%);
      animation: fadeIn 0.6s ease-out;
    }
    #bgPdf img { width: 100%; height: 100%; display: block; object-fit: contain; pointer-events: none; }
    /* —É–¥–æ–±—Å—Ç–≤–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –≤ debug */
    body.debug svg { touch-action: none; }
    /* –ø–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    svg { animation: fadeIn 0.5s ease-out; }
    #topHint { animation: fadeIn 0.6s ease-out 0.3s backwards; }
    /* –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–≤–æ—Ä–æ—Ç–∞ —ç–∫—Ä–∞–Ω–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
    @media screen and (orientation: landscape) and (max-width: 1024px) {
      body::after {
        content: '‚Üª –ü–æ–≤–µ—Ä–Ω–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ';
        position: fixed;
        inset: 0;
        z-index: 99999;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(247, 239, 230, 0.98);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        color: #321;
        font: 600 20px system-ui, -apple-system, sans-serif;
        text-align: center;
        padding: 20px;
        line-height: 1.4;
      }
      #bgPdf, main, #topHint, #ctrl {
        opacity: 0 !important;
        pointer-events: none !important;
      }
    }
  </style>
</head>
<body>
  <div id="bgPdf" aria-hidden="true"><img src="fon.webp" alt="" /></div>
  <main class="stage">
    <!-- –ë–∞–∑–æ–≤—ã–π SVG –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä. –ò—Å–ø–æ–ª—å–∑—É–µ–º viewBox –∏–∑ fon.svg –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <svg viewBox="0 0 1532.0387 2470.6868" role="img" aria-label="–ú—É–∑–µ–π –ü–µ–ª—å–º–µ–Ω–µ–π –ë—É–ª—å–∫">
      <defs>
        <filter id="circleGlow" x="-150%" y="-150%" width="400%" height="400%">
          <!-- –†–∞–∑–º—ã–≤–∞–µ–º –æ–±–≤–æ–¥–∫—É –¥–ª—è —Å–≤–µ—á–µ–Ω–∏—è -->
          <feGaussianBlur id="glowBlur" in="SourceGraphic" stdDeviation="10" result="blur" />
          <!-- –î–µ–ª–∞–µ–º —Å–≤–µ—á–µ–Ω–∏–µ —è—Ä—á–µ -->
          <feComponentTransfer in="blur" result="brightBlur">
            <feFuncA type="linear" slope="2" />
          </feComponentTransfer>
          <!-- –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å–≤–µ—á–µ–Ω–∏–µ —Å –∏—Å—Ö–æ–¥–Ω–æ–π —Ñ–æ—Ä–º–æ–π -->
          <feMerge>
            <feMergeNode in="brightBlur" />
            <feMergeNode in="SourceGraphic" />
          </feMerge>
        </filter>
        <radialGradient id="edgeFade" cx="50%" cy="50%" r="50%">
          <stop offset="0%" stop-color="#fff" />
          <stop offset="94%" stop-color="#fff" />
          <stop offset="100%" stop-color="#000" />
        </radialGradient>
        <mask id="edgeMask" maskUnits="objectBoundingBox" maskContentUnits="objectBoundingBox">
          <rect x="0" y="0" width="1" height="1" fill="url(#edgeFade)" />
        </mask>
      </defs>
      <!-- —Ñ–æ–Ω –≤–Ω—É—Ç—Ä–∏ SVG –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è; –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–¥–ª–æ–∂–µ–Ω–æ –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–ª–æ–µ–º -->

      <!-- –°–ª–æ–π —Å –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º–∏ —Ç–æ—á–∫–∞–º–∏ -->
      <g id="hotspots" />
      <g id="labels" />
    </svg>
  </main>

  <div id="topHint" aria-live="polite"><span class="icon">üëá</span><span class="text">–ù–∞–∂–∏–º–∞–π—Ç–µ –Ω–∞ –∫—Ä—É–∂–æ—á–∫–∏</span></div>

  <div id="ctrl">
    <label for="tRange">r(px)</label>
    <input id="tRange" type="range" min="10" max="64" step="1" />
    <span id="tVal" class="val"></span>
    <label for="glowRRange">Glow R</label>
    <input id="glowRRange" type="range" min="0" max="255" step="1" />
    <span id="glowRVal" class="val"></span>
    <label for="glowGRange">G</label>
    <input id="glowGRange" type="range" min="0" max="255" step="1" />
    <span id="glowGVal" class="val"></span>
    <label for="glowBRange">B</label>
    <input id="glowBRange" type="range" min="0" max="255" step="1" />
    <span id="glowBVal" class="val"></span>
    <label for="glowBlurRange">–†–∞–∑–º—ã—Ç–∏–µ</label>
    <input id="glowBlurRange" type="range" min="0" max="80" step="1" />
    <span id="glowBlurVal" class="val"></span>
    <label for="glowSpreadRange">–†–∞—Å–ø—Ä.</label>
    <input id="glowSpreadRange" type="range" min="-20" max="40" step="1" />
    <span id="glowSpreadVal" class="val"></span>
    <label for="glowIntensityRange">–ò–Ω—Ç–µ–Ω—Å.</label>
    <input id="glowIntensityRange" type="range" min="0" max="100" step="1" />
    <span id="glowIntensityVal" class="val"></span>
    <button id="previewBtn" type="button">üëÅ –ü—Ä–µ–≤—å—é</button>
    <button id="saveBtn" type="button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
    <button id="resetBtn" type="button">–°–±—Ä–æ—Å–∏—Ç—å</button>
    <button id="copyBtn" type="button">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
  </div>

  <script>
    (function() {
      const svgEl = document.querySelector('svg');
      const cx = 793.2475 / 2;
      const cy = 793.2475 / 2;
      // –ß–∏—Ç–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–µ—Å–ª–∏ –µ—Å—Ç—å) –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ä–∞–∑—É
      let savedConf = {};
      try { savedConf = JSON.parse(localStorage.getItem('bulkqrConfig') || '{}') || {}; } catch(_) {}
      if (savedConf && typeof savedConf === 'object') {
        if (savedConf.rPx != null) document.documentElement.style.setProperty('--tap', String(savedConf.rPx));
      }
      // –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏–∑ –∫–ª–∏–µ–Ω—Ç–∞ –≤ —Å–∏—Å—Ç–µ–º—É SVG
      function clientToSvg(x, y) {
        const pt = svgEl.createSVGPoint();
        pt.x = x; pt.y = y;
        const ctm = svgEl.getScreenCTM();
        if (!ctm) return { x: 0, y: 0 };
        const inv = ctm.inverse();
        const p = pt.matrixTransform(inv);
        return { x: p.x, y: p.y };
      }
      // –†–∞—Å—á—ë—Ç —Ä–∞–¥–∏—É—Å–∞ –∫—Ä—É–≥–∞ –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö viewBox, —á—Ç–æ–±—ã –¥–∏–∞–º–µ—Ç—Ä –Ω–∞ —ç–∫—Ä–∞–Ω–µ ‚âà var(--tap) px
      function computeR() {
        const style = getComputedStyle(document.documentElement);
        const tapPx = parseFloat(style.getPropertyValue('--tap')) || 56; // –¥–∏–∞–º–µ—Ç—Ä
        const rect = svgEl.getBoundingClientRect();
        const viewW = 1532.0387; // –æ–±–Ω–æ–≤–ª–µ–Ω–æ –ø–æ–¥ –Ω–æ–≤—ã–π viewBox
        const scale = viewW / rect.width; // px —ç–∫—Ä–∞–Ω–∞ -> –µ–¥–∏–Ω–∏—Ü—ã viewBox
        return (tapPx / 2) * scale; // —Ä–∞–¥–∏—É—Å –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö viewBox
      }

      // –ò—Å—Ç–æ—á–Ω–∏–∫ (–ø–æ—Ä—è–¥–æ–∫ –ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω)
      const src = [
        { file: 'sssr.pdf', label: '–ü–µ–ª—å–º–µ–Ω–∏ –≤ —ç–ø–æ—Ö—É –°–°–°–†' },
        { file: 'Otlichiya.pdf', label: '–ß–µ–º –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –ø–µ–ª—å–º–µ–Ω–∏ –æ—Ç‚Ä¶' },
        { file: 'razniestrani.pdf', label: '–ü–µ–ª—å–º–µ–Ω–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∞—Ö' },
        { file: 'interestingfacts.pdf', label: '–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ–∞–∫—Ç—ã' },
        { file: 'rituali.pdf', label: '–ü–µ–ª—å–º–µ–Ω–Ω—ã–µ —Ä–∏—Ç—É–∞–ª—ã –∏ –ø–æ–≤–µ—Ä—å–µ' },
        { file: 'uralsibir.pdf', label: '–ü–µ–ª—å–º–µ–Ω–∏ –≤ –°–∏–±–∏—Ä–∏ –∏ –Ω–∞ –£—Ä–∞–ª–µ' },
        { file: 'europe.pdf', label: '–ü–µ–ª—å–º–µ–Ω–∏ –≤ –ï–≤—Ä–æ–ø–µ –∏ –ê–∑–∏–∏ (–ï–≤—Ä–æ–ø–∞)' },
        { file: 'rus.pdf', label: '–ü–µ–ª—å–º–µ–Ω–∏ –Ω–∞ –†—É—Å–∏' },
        { file: 'china.pdf', label: '–ö–∏—Ç–∞–π' },
        { file: 'asia.pdf', label: '–ü–µ–ª—å–º–µ–Ω–∏ –≤ –ê–∑–∏–∏' }
      ];
      const N = src.length;
      const files = src.slice();

      const svgNS = 'http://www.w3.org/2000/svg';
      const hotspots = document.getElementById('hotspots');
      const labelsGroup = document.getElementById('labels');
      const params = new URLSearchParams(location.search);
      const debug = params.has('debug');
      if (debug) document.body.classList.add('debug');
      // –¶–≤–µ—Ç–∞ —Å–≤–µ—á–µ–Ω–∏—è –ø–æ –∫—Ä—É–≥—É
      const glowColors = ['rgb(211,126,102)'];
      // –í–∫–ª—é—á–∞–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—É—é –∞–Ω–∏–º–∞—Ü–∏—é
      hotspots.classList.add('sequence');
      const seqStep = 12 / files.length; // —Å–µ–∫ –Ω–∞ –æ–¥–∏–Ω —à–∞–≥, –æ–±—â–∏–π —Ü–∏–∫–ª ~12—Å
      hotspots.style.setProperty('--step', `${seqStep}s`);
      hotspots.style.setProperty('--cycle', `${(seqStep * files.length).toFixed(2)}s`);

      const baseAngles = files.map((_, i) => -90 + i * (360 / files.length));
      const circles = [];
      const glows = [];
      const anchors = [];
      const labels = [];
      function setGlowColor(color) {
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç –Ω–∞ :root –¥–ª—è SVG —Ñ–∏–ª—å—Ç—Ä–∞ –∏ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        document.documentElement.style.setProperty('--glow-color', color);
        // –û–±–Ω–æ–≤–ª—è–µ–º fill –≤—Å–µ—Ö –∫—Ä—É–∂–∫–æ–≤
        circles.forEach((c) => {
          c.setAttribute('fill', color);
        });
      }
      files.forEach((item, i) => {
        const a = document.createElementNS(svgNS, 'a');
        const url = `viewer.html?file=${encodeURIComponent('pdf/' + item.file)}`;
        a.setAttribute('href', url);
        a.setAttribute('target', '_self');
        a.setAttribute('class', 'hotspot-link');
        a.setAttribute('aria-label', item.label);
        a.setAttributeNS('http://www.w3.org/1999/xlink', 'xlink:href', url);
        const glow = document.createElementNS(svgNS, 'circle');
        glow.setAttribute('class', 'glow');
        // –ò–Ω–¥–µ–∫—Å —à–∞–≥–∞ –∏ —Ü–≤–µ—Ç —Å–≤–µ—á–µ–Ω–∏—è
        glow.style.setProperty('--i', String(i));
        const color = glowColors[i % glowColors.length];
        glow.style.setProperty('--glow-color', color);
        const circle = document.createElementNS(svgNS, 'circle');
        circle.setAttribute('class', 'hotspot');
        circle.setAttribute('fill', color);
        // –ò–Ω–¥–µ–∫—Å —à–∞–≥–∞ –∏ —Ü–≤–µ—Ç —Å–≤–µ—á–µ–Ω–∏—è
        circle.style.setProperty('--i', String(i));
        circle.style.setProperty('--glow-color', color);
        a.style.setProperty('--glow-color', color);
        a.appendChild(glow);
        a.appendChild(circle);
        hotspots.appendChild(a);
        circles.push(circle);
        glows.push(glow);
        anchors.push(a);
        // –°–Ω–∏–º–∞–µ–º —Ñ–æ–∫—É—Å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞, —á—Ç–æ–±—ã –Ω–µ –æ—Å—Ç–∞–≤–∞–ª—Å—è –∫—Ä–∞—Å–Ω—ã–π –∫—Ä—É–≥ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ
        a.addEventListener('click', (e) => { if (debug) { e.preventDefault(); } try { a.blur(); } catch(_){} });
        const t = document.createElementNS(svgNS, 'text');
        t.setAttribute('class', 'hotspot-label');
        t.textContent = String(i + 1);
        labelsGroup.appendChild(t);
        labels.push(t);
      });
      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —Ü–≤–µ—Ç —Å–≤–µ—á–µ–Ω–∏—è, –µ—Å–ª–∏ –µ—Å—Ç—å
      if (savedConf && savedConf.glowRGB) {
        const m = String(savedConf.glowRGB).match(/(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/);
        if (m) setGlowColor(`rgb(${m[1]}, ${m[2]}, ${m[3]})`);
      }
      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–≤–µ—á–µ–Ω–∏—è
      if (savedConf && typeof savedConf.glowBlur === 'number') {
        document.documentElement.style.setProperty('--glow-blur', String(savedConf.glowBlur));
        const glowBlurEl = document.getElementById('glowBlur');
        if (glowBlurEl) glowBlurEl.setAttribute('stdDeviation', String(savedConf.glowBlur / 3));
      }
      if (savedConf && typeof savedConf.glowSpread === 'number') {
        document.documentElement.style.setProperty('--glow-spread', String(savedConf.glowSpread));
      }
      if (savedConf && typeof savedConf.glowIntensity === 'number') {
        document.documentElement.style.setProperty('--glow-intensity', String(savedConf.glowIntensity / 100));
      }
      // –ü–æ–∑–∏—Ü–∏–∏ —Ç–æ—á–µ–∫: –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 2025-11-09)
      const DEFAULT_POSITIONS = [
        {x:1149.03,y:1502.02},
        {x:755.28,y:1491.28},
        {x:350.79,y:1491.28},
        {x:755.28,y:1899.35},
        {x:748.12,y:1076.05},
        {x:350.79,y:1083.21},
        {x:751.7,y:675.15},
        {x:347.21,y:675.15},
        {x:1141.87,y:678.73},
        {x:1141.87,y:1076.05}
      ];
      let positions = [];
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é –∫–æ–Ω—Ñ–∏–≥–∞ - –µ—Å–ª–∏ —Å—Ç–∞—Ä–∞—è, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
      const CONFIG_VERSION = 3; // —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
      if (savedConf && savedConf.configVersion === CONFIG_VERSION && Array.isArray(savedConf.positions) && savedConf.positions.length === N) {
        positions = savedConf.positions.map((p, i) => ({ x: +p.x || cx, y: +p.y || cy }));
      } else {
        positions = DEFAULT_POSITIONS.slice();
      }
      function setPositions() {
        positions.forEach((pos, i) => {
          const x = pos.x, y = pos.y;
          circles[i].setAttribute('cx', x.toFixed(2));
          circles[i].setAttribute('cy', y.toFixed(2));
          glows[i].setAttribute('cx', x.toFixed(2));
          glows[i].setAttribute('cy', y.toFixed(2));
          labels[i].setAttribute('x', x.toFixed(2));
          labels[i].setAttribute('y', y.toFixed(2));
        });
      }

      function applyRadius() {
        const r = computeR();
        circles.forEach(c => c.setAttribute('r', r));
        const rGlow = r * 0.7;
        glows.forEach(g => g.setAttribute('r', rGlow));
      }
      setPositions();
      applyRadius();
      window.addEventListener('resize', applyRadius);
      // –ü–æ–¥—Å–∫–∞–∑–∫–∞: —Å–Ω–∏–º–∞–µ–º –∫–ª–∞—Å—Å hints —á–µ—Ä–µ–∑ 6—Å –∏–ª–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏
      const svgRoot = document.querySelector('svg');
      const clearHints = () => { if (svgRoot) svgRoot.classList.remove('hints'); };
      setTimeout(clearHints, 6000);
      ['pointerdown','keydown','touchstart'].forEach(ev =>
        window.addEventListener(ev, clearHints, { once: true, passive: true })
      );

      // –õ—ë–≥–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –ª–µ–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–¥–∏–Ω —Ä–∞–∑)
      const HINT_KEY = 'bulkqrTopHintShown';
      const topHintEl = document.getElementById('topHint');
      function showTopHint(){ if (!topHintEl) return; topHintEl.style.display = 'flex'; requestAnimationFrame(() => topHintEl.classList.add('show')); }
      function hideTopHint(persist){ if (!topHintEl) return; topHintEl.classList.remove('show'); setTimeout(() => { topHintEl.style.display = 'none'; }, 250); if (persist) { try { localStorage.setItem(HINT_KEY, '1'); } catch(_) {} } }
      if (topHintEl && !localStorage.getItem(HINT_KEY)) {
        showTopHint();
        setTimeout(() => hideTopHint(true), 5000);
        ['pointerdown','keydown','touchstart'].forEach(ev => window.addEventListener(ev, () => hideTopHint(true), { once: true, passive: true }));
        topHintEl.addEventListener('click', () => hideTopHint(true));
      }

      // –°–Ω–∏–º–∞–µ–º —Ñ–æ–∫—É—Å—ã —É —Å—Å—ã–ª–æ–∫ –ø–æ—Å–ª–µ –≤–æ–∑–≤—Ä–∞—Ç–∞/–≤–∏–¥–∏–º–æ—Å—Ç–∏
      window.addEventListener('pageshow', () => {
        document.querySelectorAll('.hotspot-link').forEach((el) => { try { el.blur(); } catch(_){} });
      });
      document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'visible') {
          document.querySelectorAll('.hotspot-link').forEach((el) => { try { el.blur(); } catch(_){} });
        }
      });
      if (debug) {
        const tRange = document.getElementById('tRange');
        const tVal = document.getElementById('tVal');
        const saveBtn = document.getElementById('saveBtn');
        const resetBtn = document.getElementById('resetBtn');
        const glowRRange = document.getElementById('glowRRange');
        const glowGRange = document.getElementById('glowGRange');
        const glowBRange = document.getElementById('glowBRange');
        const glowRVal = document.getElementById('glowRVal');
        const glowGVal = document.getElementById('glowGVal');
        const glowBVal = document.getElementById('glowBVal');
        const glowBlurRange = document.getElementById('glowBlurRange');
        const glowBlurVal = document.getElementById('glowBlurVal');
        const glowSpreadRange = document.getElementById('glowSpreadRange');
        const glowSpreadVal = document.getElementById('glowSpreadVal');
        const glowIntensityRange = document.getElementById('glowIntensityRange');
        const glowIntensityVal = document.getElementById('glowIntensityVal');
        const previewBtn = document.getElementById('previewBtn');
        const copyBtn = document.getElementById('copyBtn');
        // –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º tRange —Ç–µ–∫—É—â–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º CSS-–ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
        const cs = getComputedStyle(document.documentElement);
        const currentTap = parseFloat(cs.getPropertyValue('--tap')) || 44;
        const currentBlur = parseFloat(cs.getPropertyValue('--glow-blur')) || 30;
        const currentSpread = parseFloat(cs.getPropertyValue('--glow-spread')) || 5;
        const currentIntensity = parseFloat(cs.getPropertyValue('--glow-intensity')) || 0.6;
        // –ó–∞–¥–∞–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å–±—Ä–æ—Å–∞
        const DEFAULTS = {
          rPx: 64,
          glow: { r: 211, g: 126, b: 102 },
          blur: 30,
          spread: 5,
          intensity: 60
        };
        // –≤—ã—á–∏—Å–ª—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π —Ü–≤–µ—Ç —Å–≤–µ—á–µ–Ω–∏—è
        function parseRGB(str){
          const m = (str || '').match(/rgba?\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)/i);
          return m ? [parseInt(m[1]), parseInt(m[2]), parseInt(m[3])] : null;
        }
        function parseHex(str){
          const s = (str || '').trim();
          if (!/^#?[0-9a-f]{6}$/i.test(s)) return null;
          const h = s.replace('#','');
          return [
            parseInt(h.slice(0,2),16),
            parseInt(h.slice(2,4),16),
            parseInt(h.slice(4,6),16)
          ];
        }
        let rgb = parseRGB(getComputedStyle(glows[0]).fill);
        if (!rgb) rgb = parseHex(cs.getPropertyValue('--glow-color')) || [211,126,102];
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–∏–µ
        const savedBlur = (savedConf && typeof savedConf.glowBlur === 'number') ? savedConf.glowBlur : currentBlur;
        const savedSpread = (savedConf && typeof savedConf.glowSpread === 'number') ? savedConf.glowSpread : currentSpread;
        const savedIntensity = (savedConf && typeof savedConf.glowIntensity === 'number') ? savedConf.glowIntensity : Math.round(currentIntensity * 100);
        tRange.value = String(currentTap);
        glowRRange.value = String(rgb[0]);
        glowGRange.value = String(rgb[1]);
        glowBRange.value = String(rgb[2]);
        glowBlurRange.value = String(savedBlur);
        glowSpreadRange.value = String(savedSpread);
        glowIntensityRange.value = String(savedIntensity);
        tVal.textContent = String(Math.round(currentTap));
        glowRVal.textContent = String(rgb[0]);
        glowGVal.textContent = String(rgb[1]);
        glowBVal.textContent = String(rgb[2]);
        glowBlurVal.textContent = String(savedBlur);
        glowSpreadVal.textContent = String(savedSpread);
        glowIntensityVal.textContent = String(savedIntensity);
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º SVG —Ñ–∏–ª—å—Ç—Ä —Ç–µ–∫—É—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
        const glowBlurEl = document.getElementById('glowBlur');
        if (glowBlurEl) {
          glowBlurEl.setAttribute('stdDeviation', String(savedBlur / 3));
        }
        tRange.addEventListener('input', (e) => {
          const val = parseFloat(e.target.value) || currentTap;
          document.documentElement.style.setProperty('--tap', String(val));
          applyRadius();
          tVal.textContent = String(Math.round(val));
        });
        function onRGBChange(){
          const r = parseInt(glowRRange.value)||0;
          const g = parseInt(glowGRange.value)||0;
          const b = parseInt(glowBRange.value)||0;
          glowRVal.textContent = String(r);
          glowGVal.textContent = String(g);
          glowBVal.textContent = String(b);
          setGlowColor(`rgb(${r}, ${g}, ${b})`);
        }
        glowRRange.addEventListener('input', onRGBChange);
        glowGRange.addEventListener('input', onRGBChange);
        glowBRange.addEventListener('input', onRGBChange);
        glowBlurRange.addEventListener('input', (e) => {
          const val = parseFloat(e.target.value) || 30;
          document.documentElement.style.setProperty('--glow-blur', String(val));
          // –û–±–Ω–æ–≤–ª—è–µ–º SVG —Ñ–∏–ª—å—Ç—Ä
          const glowBlurEl = document.getElementById('glowBlur');
          if (glowBlurEl) {
            const stdDev = val / 3;
            glowBlurEl.setAttribute('stdDeviation', String(stdDev));
          }
          glowBlurVal.textContent = String(val);
        });
        glowSpreadRange.addEventListener('input', (e) => {
          const val = parseFloat(e.target.value) || 5;
          document.documentElement.style.setProperty('--glow-spread', String(val));
          glowSpreadVal.textContent = String(val);
        });
        glowIntensityRange.addEventListener('input', (e) => {
          const val = parseInt(e.target.value) || 60;
          const intensity = val / 100;
          document.documentElement.style.setProperty('--glow-intensity', String(intensity));
          glowIntensityVal.textContent = String(val);
        });
        copyBtn.addEventListener('click', () => {
          const rPx = (getComputedStyle(document.documentElement).getPropertyValue('--tap') || '').trim();
          const r = parseInt(glowRRange.value)||0;
          const g = parseInt(glowGRange.value)||0;
          const b = parseInt(glowBRange.value)||0;
          const pos = positions.map(p => ({ x: +p.x.toFixed(2), y: +p.y.toFixed(2) }));
          const text = `rPx=${rPx}, glowRGB=rgb(${r},${g},${b}), positions=${JSON.stringify(pos)}`;
          if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(text);
            copyBtn.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ';
            setTimeout(() => copyBtn.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å', 1200);
          } else {
            alert(text);
          }
        });

        // –ö–Ω–æ–ø–∫–∞ –ø—Ä–µ–≤—å—é - –≤—Ä–µ–º–µ–Ω–Ω–æ —É–±–∏—Ä–∞–µ—Ç debug –∫–ª–∞—Å—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —ç—Ñ—Ñ–µ–∫—Ç–∞
        let previewMode = false;
        previewBtn.addEventListener('click', () => {
          previewMode = !previewMode;
          if (previewMode) {
            document.body.classList.remove('debug');
            previewBtn.textContent = 'üîß –†–µ–¥–∞–∫—Ç–æ—Ä';
            previewBtn.style.background = '#4ade80';
          } else {
            document.body.classList.add('debug');
            previewBtn.textContent = 'üëÅ –ü—Ä–µ–≤—å—é';
            previewBtn.style.background = '';
          }
        });

        saveBtn.addEventListener('click', () => {
          const csDoc = getComputedStyle(document.documentElement);
          const rPx = (csDoc.getPropertyValue('--tap') || '').trim();
          const rC = parseInt(glowRRange.value)||0;
          const gC = parseInt(glowGRange.value)||0;
          const bC = parseInt(glowBRange.value)||0;
          const blur = parseFloat(glowBlurRange.value)||30;
          const spread = parseFloat(glowSpreadRange.value)||5;
          const intensity = parseInt(glowIntensityRange.value)||60;
          const conf = {
            configVersion: 3,
            rPx: parseFloat(rPx),
            positions: positions.map(p => ({ x: +p.x.toFixed(2), y: +p.y.toFixed(2) })),
            glowRGB: `rgb(${rC},${gC},${bC})`,
            glowBlur: blur,
            glowSpread: spread,
            glowIntensity: intensity
          };
          try { localStorage.setItem('bulkqrConfig', JSON.stringify(conf)); } catch(_) {}
          const prevText = saveBtn.textContent;
          saveBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ';
          setTimeout(() => saveBtn.textContent = prevText || '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è', 1200);
        });

        // –°–±—Ä–æ—Å –∫ –¥–µ—Ñ–æ–ª—Ç—É
        resetBtn.addEventListener('click', () => {
          try { localStorage.removeItem('bulkqrConfig'); } catch(_) {}
          // CSS-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
          document.documentElement.style.setProperty('--tap', String(DEFAULTS.rPx));
          // –ü–æ–∑–∏—Ü–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
          positions = DEFAULT_POSITIONS.slice();
          setPositions();
          applyRadius();
          // –¶–≤–µ—Ç —Å–≤–µ—á–µ–Ω–∏—è
          setGlowColor(`rgb(${DEFAULTS.glow.r}, ${DEFAULTS.glow.g}, ${DEFAULTS.glow.b})`);
          // Glow –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
          document.documentElement.style.setProperty('--glow-blur', String(DEFAULTS.blur));
          document.documentElement.style.setProperty('--glow-spread', String(DEFAULTS.spread));
          document.documentElement.style.setProperty('--glow-intensity', String(DEFAULTS.intensity / 100));
          const glowBlurEl = document.getElementById('glowBlur');
          if (glowBlurEl) glowBlurEl.setAttribute('stdDeviation', String(DEFAULTS.blur / 3));
          // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤ –∏ –ø–æ–¥–ø–∏—Å–∏
          tRange.value = String(DEFAULTS.rPx);
          glowRRange.value = String(DEFAULTS.glow.r);
          glowGRange.value = String(DEFAULTS.glow.g);
          glowBRange.value = String(DEFAULTS.glow.b);
          glowBlurRange.value = String(DEFAULTS.blur);
          glowSpreadRange.value = String(DEFAULTS.spread);
          glowIntensityRange.value = String(DEFAULTS.intensity);
          tVal.textContent = String(DEFAULTS.rPx);
          glowRVal.textContent = String(DEFAULTS.glow.r);
          glowGVal.textContent = String(DEFAULTS.glow.g);
          glowBVal.textContent = String(DEFAULTS.glow.b);
          glowBlurVal.textContent = String(DEFAULTS.blur);
          glowSpreadVal.textContent = String(DEFAULTS.spread);
          glowIntensityVal.textContent = String(DEFAULTS.intensity);
          const prev = resetBtn.textContent;
          resetBtn.textContent = '–°–±—Ä–æ—à–µ–Ω–æ';
          setTimeout(() => resetBtn.textContent = prev || '–°–±—Ä–æ—Å–∏—Ç—å', 1200);
        });
      }

      // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —Ç–æ—á–µ–∫ –≤ debug-—Ä–µ–∂–∏–º–µ
      if (debug) {
        let dragIdx = -1;
        function onPointerMove(e) {
          if (dragIdx < 0) return;
          const p = clientToSvg(e.clientX, e.clientY);
          positions[dragIdx] = { x: p.x, y: p.y };
          setPositions();
        }
        function onPointerUp() {
          dragIdx = -1;
          window.removeEventListener('pointermove', onPointerMove);
          window.removeEventListener('pointerup', onPointerUp);
        }
        anchors.forEach((a, i) => {
          a.addEventListener('pointerdown', (e) => {
            e.preventDefault();
            dragIdx = i;
            window.addEventListener('pointermove', onPointerMove);
            window.addEventListener('pointerup', onPointerUp, { once: true });
          });
        });
      }

      // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∑–æ–Ω—É –∫–ª–∏–∫–∞ –¥–ª—è —Ç–∞—á-—É—Å—Ç—Ä–æ–π—Å—Ç–≤ —á–µ—Ä–µ–∑ pointer-events
      // –í–∏–∑—É–∞–ª—å–Ω–æ –∫—Ä—É–≥–∏ –Ω–µ–≤–∏–¥–∏–º—ã, –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ hover/focus

      // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–≤–æ—Ä–æ—Ç–∞ —ç–∫—Ä–∞–Ω–∞ —á–µ—Ä–µ–∑ Screen Orientation API
      if (screen.orientation && screen.orientation.lock) {
        screen.orientation.lock('portrait').catch(() => {
          // –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å (—Ç—Ä–µ–±—É–µ—Ç—Å—è fullscreen –∏–ª–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
        });
      }
    })();
  </script>
</body>
</html>
